'use strict';
var getip = require('ipware')().get_ip;

const handle = function (peer) {
  if (!peer) {
    throw new Error('Peer is missing.');
  }

  return (req, res) => {
    const action = req.params.action;

    if (!peer.handle[action]) {
      return res.sendStatus(404);
    }

    var v6ip = req.headers['x-forwarded-for'] || req.connection.remoteAddress;
    var ip = v6ip.split(':')[3];

    peer.handle[action](ip, req.body , (err, result) => {
      if (err) {
        return res.sendStatus(500);
      }
      return res.send(result || {});
    });
  };
};

module.exports = handle;
